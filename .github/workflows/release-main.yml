on:
  pull_request:
    types: [closed]

jobs:
 pullrequest:
   if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true && contains(toJSON(github.event.pull_request.labels), 'autorelease')
   runs-on: ubuntu-latest
   steps: 
       - name: print
         run: echo "${{ toJSON(github.event.pull_request.head.ref) }}"
       - name: checkout
         uses: actions/checkout@v2
       - name: Initialize Pull Request
         uses: repo-sync/pull-request@v2
         with:
           source_branch: "${{ github.event.pull_request.head.ref }}"
           destination_branch: "main"
           pr_title: "chore: ${{ github.event.pull_request.head.ref }} to main"
           pr_body: ":crown: *Autogenerated* - sync ${{ github.event.pull_request.head.ref }} to main"             
           pr_assignee: "bgsandan"                           # Comma-separated list (no spaces)
           pr_label: "autorelease: main,automerge"                               # Comma-separated list (no spaces)
           pr_allow_empty: true                              # Creates pull request even if there are no changes
           github_token: ${{ secrets.GITHUB_TOKEN }}
       - name: Automerge
         uses: "pascalgn/automerge-action@v0.13.1"
         env:
           GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
